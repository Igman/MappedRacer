<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
	  html { height: 100% }
	  body { height: 100%; margin: 0; padding: 0 }
	</style>
	<script type="text/javascript"
	    src="http://maps.googleapis.com/maps/api/js?sensor=true">
	</script>
	<script type="text/javascript">
		var initialLocation;
		var newyork = new google.maps.LatLng(40.69847032728747, -73.9514422416687);
		var browserSupportFlag =  new Boolean();
		var marker;
		var map;
		var contentString;
		var infowindow;
		
		function initialize() {
			var myOptions = {
		    	zoom: 14,
		    	mapTypeId: google.maps.MapTypeId.ROADMAP
			};
		  
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
			//Try W3C Geolocation (Preferred)
			if(navigator.geolocation) {
				browserSupportFlag = true;	// Si soporta GeoLocation
				navigator.geolocation.getCurrentPosition(function(position) {
					initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);	//Obten coordenadas
					map.setCenter(initialLocation);		//Centra el mapa
					
					marker = new google.maps.Marker({	//Crea marker
						position: initialLocation, 		//Set a poisition
						map: map						//Que mapa vas a usar
					});
					
					contentString = '<div> <img src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-snc4/273413_516332318_983113140_n.jpg" /> </div>';		//Contenido del infowindow
					
					infowindow = new google.maps.InfoWindow({	//Creacion de infowindow
					    content: contentString					//Contenido
					});
					
					google.maps.event.addListener(marker, 'click', function() {
					  infowindow.open(map,marker);			//Creacion de evento que dice que cuando le piquen al marker de cierto mapa se abra
					});
					
					google.maps.event.addListener(map, 'click', function(event){	//Creacion de evento en click
						addMarker(event.latLng);	//Manda a llamar al metodo //El evento contiene el objeto con las coordenadas
					});
					
				}, function() {
		      		handleNoGeolocation(browserSupportFlag);
		    	});
			//Browser doesn't support Geolocation
			} else {
				browserSupportFlag = false;
				handleNoGeolocation(browserSupportFlag);
			}
		  
			function handleNoGeolocation(errorFlag) {
				if (errorFlag == true) {
					alert("Geolocation service failed.");
					initialLocation = newyork;
				} else {
					alert("Your browser doesn't support geolocation. We've placed you in Siberia.");
					initialLocation = newyork;
				}
				map.setCenter(initialLocation);
			}
			
			function addMarker(latlang){												//Metodo que agrega un marker al click
				var ubicacion = new google.maps.LatLng(latlang.lat(), latlang.lng());	//Se crea una nueva ubicacion con coordenadas
				var marcador = new google.maps.Marker({									//Creacion de marker
					position: ubicacion,												//Establecer coordenadas del marker
					map: map															//En que mapa lo vamos a poner
				});					
			}
		}
	</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:80%; height:80%"></div>
</body>
</html>